from pathlib import Path
import os

import pandas as pd
import pypsa
from helpers import override_component_attrs

# Proposed code structure:
# X read network (.nc-file)
# X add export bus
# connect hydrogen buses (advanced: only ports, not all) to export bus
# add store and connect to export bus
# add load and connect to export bus



if __name__ == "__main__":
    if "snakemake" not in globals():
        os.chdir(os.path.dirname(os.path.abspath(__file__)))
        from helpers import mock_snakemake, sets_path_to_root

        snakemake = mock_snakemake(
            "add_endogenous_demand",
            simpl="",
            clusters="20",
            ll="c1.0",
            opts="Co2L",
            planning_horizons="2030",
            sopts="730H",
            discountrate=0.069,
        )
        sets_path_to_root("pypsa-earth-sec")
    
    overrides = override_component_attrs(snakemake.input.overrides)
    n = pypsa.Network(snakemake.input.network, override_component_attrs=overrides)

    hydrogen_buses = n.buses[n.buses.index.str.contains("H2")]
    print(hydrogen_buses)

    n.add(
        "Bus",
        "H2 export bus",
        carrier = "H2",
    )

    print("code done")
